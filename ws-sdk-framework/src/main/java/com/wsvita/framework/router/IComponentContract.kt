package com.wsvita.framework.router

/**
 * -------------------------------------------------------------------------------------
 * 【统一路由响应状态包装类 (Sealed Component Response)】
 * -------------------------------------------------------------------------------------
 * [1. 设计背景]
 * 在跨组件跳转中，目标页面的返回结果不仅仅是“数据”，还包含“状态”。
 * 本类利用 Kotlin 的 [sealed class] 特性，强制调用方必须处理所有可能的返回分支，
 * 从而避免了遗漏“取消”或“异常”情况导致的业务逻辑漏洞。
 *
 * [2. 状态分支说明]
 * - [Success]：操作成功，并携带解析后的业务对象 [data]。
 * - [Canceled]：用户主动取消操作（如点击返回键、取消按钮），此时无回传数据。
 * - [Failure]：业务逻辑失败（如权限拒绝、逻辑校验未通过），携带错误码和错误信息。
 * -------------------------------------------------------------------------------------
 */
sealed class ComponentResponse<out T> {
    /** 成功状态：包含强类型业务数据 [T] */
    data class Success<T>(val action : String,val data: T) : ComponentResponse<T>()

    /** 取消状态：代表用户中断了操作，通常对应系统的 RESULT_CANCELED */
    object Canceled : ComponentResponse<Nothing>()

    /** 失败状态：包含自定义错误码 [code] 和可选的错误描述 [msg] */
    data class Failure(val action : String,val code: Int, val msg: String? = null) : ComponentResponse<Nothing>()
}

/**
 * -------------------------------------------------------------------------------------
 * 【组件通信契约接口 (Component Communication Contract)】
 * -------------------------------------------------------------------------------------
 * [1. 职责说明]
 * 该接口定义了跨模块/跨页面通信时的“数据转换标准”。它不关心页面如何跳转，只关心：
 * 1. 发起跳转时，如何把业务对象 [I] 转换成系统能识别的 [Bundle]。
 * 2. 结果返回时，如何从系统的 [Intent] 中提取并还原出业务对象 [O]。
 *
 * [2. 泛型参数说明]
 * @param I (Input)：输入类型。代表跳转到目标页时，调用方需要提供的原始数据。
 * @param O (Output)：输出类型。代表目标页关闭后，回传给调用方的解析后的数据。
 * -------------------------------------------------------------------------------------
 */
interface IComponentContract<I, O> {

    /**
     * ---------------------------------------------------------------------------------
     * 【数据装箱：业务对象 -> 系统容器】
     * ---------------------------------------------------------------------------------
     * [作用]：
     * 该方法发生在“跳出去”之前。将你传给 router 方法的参数 [input] 转化为系统能识别的 [Bundle]。
     *
     * [子类复写说明]：
     * 子类**必须或根据需要复写**此方法。
     * - **默认实现**：在 [CommonRouterContract] 中，由于 I 已被固定为 Bundle，通常直接返回 input。
     * - **自定义实现**：如果你想传一个 User 对象，你需要在此处通过 Bundle.putParcelable 存入，
     * 并指定一个私有的 Key。
     *
     * create by Administrator at 2026/1/4 23:48
     * @author Administrator
     *
     * @param input 发起跳转时传入的原始业务数据。
     * @return 填充好 Key-Value 的 Bundle 对象，若无参数可返回 null 或 Bundle.EMPTY。
     */
    fun createInput(input: I): android.os.Bundle?

    /**
     * ---------------------------------------------------------------------------------
     * 【数据脱壳：系统容器 -> 业务对象】
     * ---------------------------------------------------------------------------------
     * [作用]：
     * 该方法发生在“回来”的时候。从目标页返回的 [Intent] 中提取出业务需要的强类型数据 [O]。
     *
     * [子类复写说明]：
     * 子类**必须复写**此方法。
     * - **职责**：它是结果解析的唯一出口。你需要知道目标页回传时的 Key 是什么，
     * 并在此处将其 get 出来并转型为 [O]。
     * - **稳定性**：应在此处处理类型转换异常或空值判断，确保回调给 onSuccess 的数据是安全的。
     *
     * create by Administrator at 2026/1/4 23:48
     * @author Administrator
     *
     * @param data 目标 Activity 返回的原始 Intent 数据。
     * @return 解析后的强类型业务结果 [O]，解析失败或无结果应返回 null。
     */
    fun convertToOutput(data: android.content.Intent): O?
}
